From 35b654dc2d12a0becaad68c692d5f72ce9d04fd8 Mon Sep 17 00:00:00 2001
From: object-Object <object@objectobject.ca>
Date: Sun, 6 Jul 2025 23:34:11 -0400
Subject: [PATCH 1/3] Add CONFIG_XIP_KERNEL case for RV32 trampoline setup

---
 arch/riscv/mm/init.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/arch/riscv/mm/init.c b/arch/riscv/mm/init.c
index 8d0374d7ce8e..a2c6c27ddc30 100644
--- a/arch/riscv/mm/init.c
+++ b/arch/riscv/mm/init.c
@@ -1212,8 +1212,13 @@ asmlinkage void __init setup_vm(uintptr_t dtb_pa)
 #endif
 #else
 	/* Setup trampoline PGD */
+#ifdef CONFIG_XIP_KERNEL
+	create_pgd_mapping(trampoline_pg_dir, kernel_map.virt_addr,
+			   kernel_map.xiprom, PGDIR_SIZE, PAGE_KERNEL_EXEC);
+#else
 	create_pgd_mapping(trampoline_pg_dir, kernel_map.virt_addr,
 			   kernel_map.phys_addr, PGDIR_SIZE, PAGE_KERNEL_EXEC);
+#endif
 #endif
 
 	/*

base-commit: 19272b37aa4f83ca52bdf9c16d5d81bdd1354494
-- 
2.25.1

